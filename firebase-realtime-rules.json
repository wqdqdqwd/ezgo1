{
  "rules": {
    "users": {
      ".read": "auth != null && (auth.token.admin == true)",
      ".write": "auth != null && (auth.token.admin == true)",
      "$uid": {
        ".read": "auth != null && (auth.uid == $uid || auth.token.admin == true)",
        ".write": "auth != null && (auth.uid == $uid || auth.token.admin == true)",
        ".validate": "newData.hasChildren(['email', 'full_name', 'created_at'])",
        
        "email": {
          ".validate": "newData.isString() && newData.val().matches(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$/)"
        },
        
        "full_name": {
          ".validate": "newData.isString() && newData.val().length >= 2 && newData.val().length <= 100"
        },
        
        "subscription_status": {
          ".validate": "newData.isString() && (newData.val() == 'trial' || newData.val() == 'active' || newData.val() == 'expired')"
        },
        
        "role": {
          ".write": "auth.token.admin == true"
        },
        
        "binance_api_key": {
          ".read": "auth.uid == $uid",
          ".write": "auth.uid == $uid"
        },
        
        "binance_api_secret": {
          ".read": "auth.uid == $uid", 
          ".write": "auth.uid == $uid"
        },
        
        "bot_settings": {
          ".read": "auth.uid == $uid",
          ".write": "auth.uid == $uid"
        },
        
        "total_trades": {
          ".validate": "newData.isNumber() && newData.val() >= 0"
        },
        
        "total_pnl": {
          ".validate": "newData.isNumber()"
        },
        
        "account_balance": {
          ".validate": "newData.isNumber() && newData.val() >= 0"
        }
      }
    },
    
    "trades": {
      ".read": "auth != null && auth.token.admin == true",
      ".write": "auth != null",
      "$tradeId": {
        ".read": "auth != null && (data.child('user_id').val() == auth.uid || auth.token.admin == true)",
        ".write": "auth != null && (data.child('user_id').val() == auth.uid || auth.token.admin == true)",
        ".validate": "newData.hasChildren(['user_id', 'symbol', 'timestamp'])",
        
        "user_id": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },
        
        "symbol": {
          ".validate": "newData.isString() && newData.val().matches(/^[A-Z]{3,10}USDT$/)"
        },
        
        "side": {
          ".validate": "newData.isString() && (newData.val() == 'LONG' || newData.val() == 'SHORT' || newData.val() == 'BUY' || newData.val() == 'SELL')"
        }
      }
    },
    
    "payment_notifications": {
      ".read": "auth != null && auth.token.admin == true",
      ".write": "auth != null",
      "$paymentId": {
        ".read": "auth != null && (data.child('user_id').val() == auth.uid || auth.token.admin == true)",
        ".write": "auth != null && (data.child('user_id').val() == auth.uid || auth.token.admin == true)",
        ".validate": "newData.hasChildren(['user_id', 'user_email', 'transaction_hash', 'amount'])",
        
        "status": {
          ".write": "auth.token.admin == true || (data.val() == null && newData.val() == 'pending')"
        },
        
        "approved_by": {
          ".write": "auth.token.admin == true"
        },
        
        "rejected_by": {
          ".write": "auth.token.admin == true"
        }
      }
    },
    
    "support_messages": {
      ".read": "auth != null && auth.token.admin == true",
      ".write": "auth != null",
      "$messageId": {
        ".read": "auth != null && (data.child('user_id').val() == auth.uid || auth.token.admin == true)",
        ".write": "auth != null && (data.child('user_id').val() == auth.uid || auth.token.admin == true)",
        ".validate": "newData.hasChildren(['user_id', 'user_email', 'subject', 'message'])",
        
        "status": {
          ".write": "auth.token.admin == true || (data.val() == null && newData.val() == 'open')"
        },
        
        "resolved_by": {
          ".write": "auth.token.admin == true"
        }
      }
    },
    
    "bot_status": {
      "$uid": {
        ".read": "auth != null && (auth.uid == $uid || auth.token.admin == true)",
        ".write": "auth != null && auth.uid == $uid"
      }
    },
    
    ".read": false,
    ".write": false
  }
}